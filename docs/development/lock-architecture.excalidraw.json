{
  "type": "excalidraw",
  "version": 2,
  "source": "https://excalidraw.com",
  "elements": [
    {
      "id": "title",
      "type": "text",
      "x": 400,
      "y": 20,
      "width": 400,
      "height": 40,
      "text": "Lock File System Architecture",
      "fontSize": 28,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 30,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "lockstore-trait-box",
      "type": "rectangle",
      "x": 350,
      "y": 80,
      "width": 500,
      "height": 220,
      "strokeColor": "#1971c2",
      "backgroundColor": "#e7f5ff",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "lockstore-trait-title",
      "type": "text",
      "x": 510,
      "y": 90,
      "width": 200,
      "height": 30,
      "text": "<<trait>> LockStore",
      "fontSize": 20,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 22,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "lockstore-trait-methods",
      "type": "text",
      "x": 370,
      "y": 130,
      "width": 460,
      "height": 160,
      "text": "+ get(&self, key: &LockKey) -> Option<&CommitSha>\n+ set(&mut self, resolved: &ResolvedAction)\n+ has(&self, key: &LockKey) -> bool\n+ retain(&mut self, keys: &[LockKey])\n+ build_update_map(&self, keys) -> HashMap<ActionId, String>\n+ save(&mut self) -> Result<(), LockFileError>",
      "fontSize": 14,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 150,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "filelock-box",
      "type": "rectangle",
      "x": 100,
      "y": 380,
      "width": 380,
      "height": 260,
      "strokeColor": "#2f9e44",
      "backgroundColor": "#ebfbee",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "filelock-title",
      "type": "text",
      "x": 220,
      "y": 390,
      "width": 140,
      "height": 30,
      "text": "FileLock",
      "fontSize": 20,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 22,
      "strokeColor": "#2f9e44",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "filelock-desc",
      "type": "text",
      "x": 140,
      "y": 420,
      "width": 300,
      "height": 20,
      "text": "(File-backed, persists to disk)",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 16,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "filelock-fields",
      "type": "text",
      "x": 120,
      "y": 450,
      "width": 340,
      "height": 180,
      "text": "Fields:\n  actions: HashMap<LockKey, CommitSha>\n  path: Option<PathBuf>\n  dirty: bool  (tracks changes)\n\nMethods:\n  + path() -> Result<&Path>\n  + load(path) -> Result<Self>\n  + load_or_default(path) -> Result<Self>\n  - save_to_disk() -> Result<()>",
      "fontSize": 13,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 170,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "memorylock-box",
      "type": "rectangle",
      "x": 540,
      "y": 380,
      "width": 380,
      "height": 200,
      "strokeColor": "#e8590c",
      "backgroundColor": "#fff4e6",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "memorylock-title",
      "type": "text",
      "x": 660,
      "y": 390,
      "width": 140,
      "height": 30,
      "text": "MemoryLock",
      "fontSize": 20,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 22,
      "strokeColor": "#e8590c",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "memorylock-desc",
      "type": "text",
      "x": 590,
      "y": 420,
      "width": 280,
      "height": 20,
      "text": "(In-memory only, no persistence)",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 16,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "memorylock-fields",
      "type": "text",
      "x": 560,
      "y": 450,
      "width": 340,
      "height": 120,
      "text": "Fields:\n  actions: HashMap<LockKey, CommitSha>\n\nBehavior:\n  save() is a no-op (returns Ok(()))\n  No path or dirty tracking needed",
      "fontSize": 13,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 110,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "implements-arrow-1",
      "type": "arrow",
      "x": 290,
      "y": 380,
      "width": 0,
      "height": 70,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "points": [[0, 0], [0, -70]],
      "startArrowhead": null,
      "endArrowhead": "triangle"
    },
    {
      "id": "implements-arrow-2",
      "type": "arrow",
      "x": 730,
      "y": 380,
      "width": 0,
      "height": 70,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "points": [[0, 0], [0, -70]],
      "startArrowhead": null,
      "endArrowhead": "triangle"
    },
    {
      "id": "implements-label-1",
      "type": "text",
      "x": 300,
      "y": 340,
      "width": 100,
      "height": 20,
      "text": "implements",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "left",
      "baseline": 16,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "implements-label-2",
      "type": "text",
      "x": 740,
      "y": 340,
      "width": 100,
      "height": 20,
      "text": "implements",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "left",
      "baseline": 16,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "lockkey-box",
      "type": "rectangle",
      "x": 100,
      "y": 700,
      "width": 280,
      "height": 160,
      "strokeColor": "#9c36b5",
      "backgroundColor": "#f8f0fc",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "lockkey-title",
      "type": "text",
      "x": 190,
      "y": 710,
      "width": 100,
      "height": 26,
      "text": "LockKey",
      "fontSize": 18,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 20,
      "strokeColor": "#9c36b5",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "lockkey-fields",
      "type": "text",
      "x": 120,
      "y": 745,
      "width": 240,
      "height": 105,
      "text": "id: ActionId\nversion: Version\n\nDisplay: \"action@version\"\n+ parse(s) -> Option<Self>",
      "fontSize": 13,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 100,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "resolvedaction-box",
      "type": "rectangle",
      "x": 430,
      "y": 700,
      "width": 280,
      "height": 160,
      "strokeColor": "#9c36b5",
      "backgroundColor": "#f8f0fc",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "resolvedaction-title",
      "type": "text",
      "x": 500,
      "y": 710,
      "width": 140,
      "height": 26,
      "text": "ResolvedAction",
      "fontSize": 18,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 20,
      "strokeColor": "#9c36b5",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "resolvedaction-fields",
      "type": "text",
      "x": 450,
      "y": 745,
      "width": 240,
      "height": 105,
      "text": "id: ActionId\nversion: Version\nsha: CommitSha\n\n+ to_workflow_ref() -> \"SHA # version\"",
      "fontSize": 13,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 100,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "commitsha-box",
      "type": "rectangle",
      "x": 760,
      "y": 700,
      "width": 200,
      "height": 100,
      "strokeColor": "#9c36b5",
      "backgroundColor": "#f8f0fc",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "commitsha-title",
      "type": "text",
      "x": 810,
      "y": 710,
      "width": 100,
      "height": 26,
      "text": "CommitSha",
      "fontSize": 18,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 20,
      "strokeColor": "#9c36b5",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "commitsha-fields",
      "type": "text",
      "x": 780,
      "y": 745,
      "width": 160,
      "height": 45,
      "text": "String (40 hex chars)\ne.g., \"abc123def456...\"",
      "fontSize": 13,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 40,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "uses-arrow-1",
      "type": "arrow",
      "x": 240,
      "y": 640,
      "width": 0,
      "height": 50,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "strokeStyle": "dashed",
      "roughness": 0,
      "points": [[0, 0], [0, 50]],
      "startArrowhead": null,
      "endArrowhead": "arrow"
    },
    {
      "id": "uses-label-1",
      "type": "text",
      "x": 250,
      "y": 655,
      "width": 80,
      "height": 20,
      "text": "key type",
      "fontSize": 11,
      "fontFamily": 1,
      "textAlign": "left",
      "baseline": 16,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "uses-arrow-2",
      "type": "arrow",
      "x": 570,
      "y": 580,
      "width": 0,
      "height": 110,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "strokeStyle": "dashed",
      "roughness": 0,
      "points": [[0, 0], [0, 110]],
      "startArrowhead": null,
      "endArrowhead": "arrow"
    },
    {
      "id": "uses-label-2",
      "type": "text",
      "x": 580,
      "y": 620,
      "width": 100,
      "height": 20,
      "text": "set() input",
      "fontSize": 11,
      "fontFamily": 1,
      "textAlign": "left",
      "baseline": 16,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "gxlock-file-box",
      "type": "rectangle",
      "x": 950,
      "y": 380,
      "width": 320,
      "height": 320,
      "strokeColor": "#495057",
      "backgroundColor": "#f8f9fa",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "gxlock-file-title",
      "type": "text",
      "x": 1040,
      "y": 390,
      "width": 140,
      "height": 26,
      "text": "gx.lock (TOML)",
      "fontSize": 18,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 20,
      "strokeColor": "#495057",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "gxlock-file-content",
      "type": "text",
      "x": 970,
      "y": 430,
      "width": 280,
      "height": 260,
      "text": "version = \"1.0\"\n\n[actions]\n\"actions/checkout@v4\" = \"abc123...\"\n\"actions/setup-node@v3\" = \"def456...\"\n\n------------------------------\nFormat:\n  key: \"action@version\" (LockKey)\n  value: CommitSha (40 hex chars)\n\nSaved via FileLock.save()\nLoaded via FileLock.load_or_default()",
      "fontSize": 13,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 250,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "file-io-arrow",
      "type": "arrow",
      "x": 480,
      "y": 500,
      "width": 460,
      "height": 0,
      "strokeColor": "#2f9e44",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "points": [[0, 0], [460, 0]],
      "startArrowhead": "arrow",
      "endArrowhead": "arrow"
    },
    {
      "id": "file-io-label",
      "type": "text",
      "x": 620,
      "y": 475,
      "width": 180,
      "height": 20,
      "text": "load_or_default() / save()",
      "fontSize": 12,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 16,
      "strokeColor": "#2f9e44",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "lockdata-box",
      "type": "rectangle",
      "x": 950,
      "y": 80,
      "width": 320,
      "height": 140,
      "strokeColor": "#495057",
      "backgroundColor": "#dee2e6",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "lockdata-title",
      "type": "text",
      "x": 1050,
      "y": 90,
      "width": 120,
      "height": 26,
      "text": "LockData",
      "fontSize": 18,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 20,
      "strokeColor": "#495057",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "lockdata-desc",
      "type": "text",
      "x": 990,
      "y": 115,
      "width": 240,
      "height": 20,
      "text": "(Internal TOML serialization)",
      "fontSize": 11,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 16,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "lockdata-fields",
      "type": "text",
      "x": 970,
      "y": 140,
      "width": 280,
      "height": 70,
      "text": "version: String (\"1.0\")\nactions: HashMap<String, String>\n  // \"action@version\" -> \"sha\"",
      "fontSize": 13,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 65,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "serde-arrow",
      "type": "arrow",
      "x": 1110,
      "y": 230,
      "width": 0,
      "height": 140,
      "strokeColor": "#495057",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "strokeStyle": "dashed",
      "roughness": 0,
      "points": [[0, 0], [0, 140]],
      "startArrowhead": "arrow",
      "endArrowhead": "arrow"
    },
    {
      "id": "serde-label",
      "type": "text",
      "x": 1120,
      "y": 290,
      "width": 120,
      "height": 20,
      "text": "serde (de)serialize",
      "fontSize": 11,
      "fontFamily": 1,
      "textAlign": "left",
      "baseline": 16,
      "strokeColor": "#495057",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "operations-box",
      "type": "rectangle",
      "x": 100,
      "y": 920,
      "width": 600,
      "height": 200,
      "strokeColor": "#1864ab",
      "backgroundColor": "#e7f5ff",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "operations-title",
      "type": "text",
      "x": 310,
      "y": 930,
      "width": 180,
      "height": 26,
      "text": "Key Operations Flow",
      "fontSize": 18,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 20,
      "strokeColor": "#1864ab",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "operations-content",
      "type": "text",
      "x": 120,
      "y": 965,
      "width": 560,
      "height": 145,
      "text": "1. load_or_default(path)\n   -> If file exists: parse TOML -> FileLock with actions map\n   -> If not exists: empty FileLock with path set\n\n2. set(resolved: &ResolvedAction)\n   -> Creates LockKey from resolved.id + resolved.version\n   -> Inserts key -> resolved.sha into actions map\n   -> Sets dirty = true if value changed\n\n3. save()\n   -> If dirty: serialize to TOML via LockData, write to path\n   -> Sets dirty = false after successful write",
      "fontSize": 12,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 140,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "workflow-update-box",
      "type": "rectangle",
      "x": 740,
      "y": 920,
      "width": 400,
      "height": 200,
      "strokeColor": "#862e9c",
      "backgroundColor": "#f8f0fc",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "workflow-update-title",
      "type": "text",
      "x": 840,
      "y": 930,
      "width": 200,
      "height": 26,
      "text": "Workflow Integration",
      "fontSize": 18,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 20,
      "strokeColor": "#862e9c",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "workflow-update-content",
      "type": "text",
      "x": 760,
      "y": 965,
      "width": 360,
      "height": 145,
      "text": "build_update_map(keys) produces:\n\n  HashMap<ActionId, String>\n  \"actions/checkout\" -> \"abc123... # v4\"\n\nUsed to update workflow files:\n  uses: actions/checkout@abc123... # v4\n\nFormat: \"SHA # version\" via\n  ResolvedAction.to_workflow_ref()",
      "fontSize": 12,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 140,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "error-box",
      "type": "rectangle",
      "x": 950,
      "y": 740,
      "width": 320,
      "height": 140,
      "strokeColor": "#c92a2a",
      "backgroundColor": "#fff5f5",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "error-title",
      "type": "text",
      "x": 1040,
      "y": 750,
      "width": 140,
      "height": 26,
      "text": "LockFileError",
      "fontSize": 18,
      "fontFamily": 1,
      "textAlign": "center",
      "baseline": 20,
      "strokeColor": "#c92a2a",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    },
    {
      "id": "error-content",
      "type": "text",
      "x": 970,
      "y": 785,
      "width": 280,
      "height": 85,
      "text": "- Read { path, source: io::Error }\n- Parse { path, source: toml::Error }\n- Write { path, source: io::Error }\n- Serialize(toml::ser::Error)\n- PathNotInitialized",
      "fontSize": 12,
      "fontFamily": 3,
      "textAlign": "left",
      "baseline": 80,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0
    }
  ],
  "appState": {
    "gridSize": null,
    "viewBackgroundColor": "#ffffff"
  },
  "files": {}
}
